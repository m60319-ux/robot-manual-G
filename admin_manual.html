<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>軟體操作手冊管理 | 後台</title>
    <link rel="stylesheet" href="assets/styles.css">
    <link rel="icon" href="data:,">
    <script src="assets/libs/papaparse.min.js"></script>
</head>
<body class="admin-mode">

    <!-- 第一欄：設定與分類樹 -->
    <aside id="admin-sidebar">
        <div style="padding: 10px; background:#f8f9fa; border-bottom:1px solid #ddd;">
            <a href="admin.html" class="btn-back">⬅ 返回後台首頁</a>
        </div>

        <div class="mode-tabs">
            <button class="tab-btn active" onclick="switchMode('local')">🏠 本機離線</button>
            <button class="tab-btn" onclick="switchMode('github')">☁️ GitHub 線上</button>
        </div>

        <!-- 本機面板 -->
        <div id="panel-local" class="mode-panel active">
            <button class="btn-blue" style="width:100%" onclick="connectLocalFolder()">📁 1. 連接資料夾</button>
            <div id="local-status" class="status-tag status-err" style="display:none">未連接</div>
            <hr>
            <label>2. 載入語言檔 (JSON)</label>
            <div class="btn-group">
                <button onclick="loadLocalFile('zh')">繁中</button>
                <button onclick="loadLocalFile('en')">EN</button>
                <button onclick="loadLocalFile('cn')">CN</button>
                <button onclick="loadLocalFile('th')">TH</button>
            </div>
            <hr>
            <label>CSV 操作</label>
            <div style="display:flex; gap:5px; margin-bottom:5px;">
                <button class="btn-gray" style="flex:1" onclick="exportToCSV()">📥 匯出</button>
                <button class="btn-gray" style="flex:1" onclick="document.getElementById('csv-upload').click()">📤 匯入</button>
                <input type="file" id="csv-upload" accept=".csv" style="display:none" onchange="importFromCSV(this)">
            </div>
        </div>

        <!-- GitHub 面板 -->
        <div id="panel-github" class="mode-panel">
            <input type="password" id="gh_token" placeholder="Token (ghp_...)" style="font-size:12px;">
            <div style="display:flex; gap:5px;">
                <input type="text" id="gh_user" placeholder="User" style="font-size:12px;">
                <input type="text" id="gh_repo" placeholder="Repo" style="font-size:12px;">
            </div>
            <button class="btn-gray" style="width:100%; margin-top:5px;" onclick="saveGhConfig()">💾 儲存設定</button>
            <hr>
            <label>GitHub 操作</label>
            <div class="btn-group">
                <button onclick="loadGithubFile('zh')">繁中</button>
                <button onclick="loadGithubFile('en')">EN</button>
                <button onclick="loadGithubFile('cn')">CN</button>
                <button onclick="loadGithubFile('th')">TH</button>
            </div>
            <div style="display:flex; gap:5px; margin-top:5px;">
                <button class="btn-gray" style="flex:1" onclick="exportToCSV()">☁️ 匯出 CSV</button>
                <button class="btn-gray" style="flex:1" onclick="loadCsvFromGithub()">☁️ 載入 CSV</button>
            </div>
            <p style="font-size:11px; color:#666; margin:3px 0 0 0;">* 讀寫位置: assets/manual/data/</p>
        </div>

        <!-- 分類樹 -->
        <div id="tree-wrapper">
            <div id="tree-root">
                <p style="padding:20px; color:#999; text-align:center; font-size:14px;">
                    請先點擊上方按鈕<br>載入資料檔案
                </p>
            </div>
        </div>
    </aside>

    <!-- 第二欄：頁面列表 -->
    <div id="admin-list-panel" class="question-list-panel">
        <div class="search-box">
            <input type="text" id="list-filter" placeholder="🔍 篩選頁面..." oninput="filterQuestionList(this.value)">
        </div>
        <div id="list-root">
            <div style="padding:40px 20px; text-align:center; color:#999;">
                請點選左側<br>📂 子章節
            </div>
        </div>
    </div>

    <!-- 第三欄：編輯區 -->
    <main id="admin-main">
        <div class="main-toolbar">
            <div class="group-left">
                <button onclick="addNode('cat')" class="btn-gray">➕ 主章節</button>
                <button onclick="addNode('sub')" class="btn-gray">➕ 子章節</button>
                <button onclick="addNode('q')" class="btn-blue">➕ 新增頁面</button>
            </div>
            <div class="group-right">
                <button onclick="deleteNode()" class="btn-red">🗑️ 刪除</button>
                <button id="saveGithubBtn" class="btn-green" onclick="saveData()">💾 儲存變更</button>
            </div>
        </div>

        <!-- 編輯面板 -->
        <div class="card" id="editor-panel" style="display:none;">
            <h2>編輯內容 <span id="node-type" style="font-size:0.5em; background:#eee; padding:2px;"></span></h2>
            
            <div id="div-move-group" style="margin-bottom: 15px; display: none; background: #e3f2fd; padding: 10px; border-radius: 4px;">
                <label style="color:#0056b3;">📂 所屬章節 (移動至...)</label>
                <select id="inp-parent-sub" style="width:100%; padding:8px; border:1px solid #007bff;"></select>
            </div>

            <label>ID (頁面編號)</label><input type="text" id="inp-id">
            <label>標題 / 功能名稱</label><input type="text" id="inp-title">
            
            <div id="q-fields" style="display:none;">
                <div class="hint">💡 提示：在輸入框按 <b>Ctrl+V</b> 可直接貼上圖片</div>
                
                <!-- 雖然 ID 維持不變以相容 JS，但 Label 改為適合手冊的用語 -->
                <label>功能概述 / 主要內容 (Main Content)</label>
                <div id="container-symptoms" class="list-editor-container"></div>
                
                <label>操作步驟 (Steps)</label>
                <div id="container-steps" class="list-editor-container"></div>
                
                <label>詳細參數說明 (Details)</label>
                <div id="container-causes" class="list-editor-container"></div>
                
                <label>關鍵字 (Keywords)</label>
                <textarea id="inp-keywords" class="paste-area" placeholder="請輸入關鍵字，一行一個"></textarea>
                
                <label>備註 (Notes)</label><textarea id="inp-notes" class="paste-area"></textarea>
            </div>
            
            <div style="text-align:right; margin-top:15px;">
                <span style="font-size:0.9em; color:#666; margin-right:10px;">(切換項目或按 Enter 自動暫存)</span>
                <button class="btn-blue" onclick="applyEdit()">✅ 手動暫存 (Apply)</button>
            </div>
        </div>
        
        <!-- 尚未選擇項目時的提示 -->
        <div id="empty-editor-msg" style="text-align:center; padding:50px; color:#ccc;">
            👈 請從左側列表選擇章節/頁面以編輯
        </div>
    </main>

    <!-- ✨✨✨ 關鍵設定：指定本頁面管理 'manual' 模組 ✨✨✨ -->
    <script>
        window.ModuleConfig = {
            name: 'manual',
            dataPath: 'assets/manual/data/',
            imgPath: 'assets/manual/images/'
        };
    </script>
    <script src="assets/admin.js"></script>
</body>
</html>
